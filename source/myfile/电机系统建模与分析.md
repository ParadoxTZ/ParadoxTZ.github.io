# 电机系统建模与分析

## 摘要

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模17.jpg" alt="电机建模17" style="zoom: 33%;" />

##  微分方程数值解法

### 一阶微分方程

设一阶微分方程的一般形式为：
$$
\frac{\text dx}{\text dt}=\text px=f(t,x)
$$
倘若已知初始时刻的变量值（如：$x(0)$），想要得到下一时刻的值，基本思路是$x_{i+1}=x_i+\text px\cdot \Delta t$

设等步长，相邻两时刻间的时间差（步长）为$h$，

**四阶龙格-库塔法：**
$$
\begin{gather*}
K_1=f(t_i,x_i)&\Rightarrow& x_{i+\frac12}^{(1)}=x_i+K_1\frac h2\\
K_2=f(t_{i+\frac12},x_{i+\frac12}^{(1)})&\Rightarrow& x_{i+\frac12}^{(2)}=x_i+K_2\frac h2\\
K_3=f(t_{i+\frac12},x_{i+\frac12}^{(2)})&\Rightarrow &x_{i+1}^{(1)}=x_i+K_3h\\
K_4=f(t_{i+1},x_{i+1}^{(1)})&\Rightarrow&K=\frac{K_1+2K_2+2K_3+K_4}6\\
&x_{i+1}=x_i+Kh
\end{gather*}
$$

### 一阶微分方程组

一般采用同步梯度的方式求解多变量方程组，这里以两变量为例：
$$
\begin{gather*}
K_{1x}=f_x(t_i,x_i,y_i)&K_{1y}=f_y(t_i,x_i,y_i)\\\Rightarrow x_{i+\frac12}^{(1)}=x_i+K_{1x}\frac h2&y_{i+\frac12}^{(1)}=y_i+K_{1y}\frac h2\\
K_{2x}=f_x(t_{i+\frac12},x_{i+\frac12}^{(1)},y_{i+\frac12}^{(1)})&K_{2y}=f_y(t_{i+\frac12},x_{i+\frac12}^{(1)},y_{i+\frac12}^{(1)})\\\Rightarrow x_{i+\frac12}^{(2)}=x_i+K_{2x}\frac h2&y_{i+\frac12}^{(2)}=y_i+K_{2y}\frac h2

\end{gather*}
$$
后面不抄了，K3K4一样的，反正意思就是同步更新。

## 一般化电机模型

###  基本概念

一般化电机的基本假设：

1. 一对级电机（$p=1$），极对数是可以等效的
2. 绕组是可以等效的，如三相变为两相
3. 伪静止线圈：构成线圈的导体是运动的（以$\omega$旋转），但是d、q线圈是由电刷所规定的，因此轴线静止。
   1. 线圈中的电流在空间产生轴线静止的磁场
   2. 导体实际上在旋转，因此还是会有旋转电势
4. 磁路不饱和（可用叠加原理）
5. 不计剩磁、涡流、磁滞损耗
6. 气隙磁密按正弦规律分布
7. 只关心导体分布在哪些槽内，不关心具体的连接方式和整、短距等

### 基本方程式

#### 正方向的规定

|            | 原则                                                         | 模型                                                         | 方程式                                                       |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **电动机** | 1. 正电流产生正磁链<br />2. 从外向线圈看，电压与电流正方向相同<br />3. 线圈的输入功率为正值 | <img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模04.png" alt="电机建模04" style="zoom: 33%;" /> | $\begin{gather*}\varPsi=Li\\U=Ri+e\\e=\text p\varPsi\end{gather*}$ |
| **发电机** | 1. 正电流产生负磁链<br />2. 从线圈向外看，电压与电流正方向相同<br />3. 线圈的输出功率为正值 | <img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模05.png" alt="电机建模05" style="zoom:33%;" /> | $\begin{gather*}\varPsi=-Li\\U=e-Ri\\e=\text p\varPsi\end{gather*}$ |

|            | 原则                                                         | 方程式                       | 功率             |
| ---------- | ------------------------------------------------------------ | ---------------------------- | ---------------- |
| **电动机** | 1. 电磁转矩正方向就是旋转方向<br />2.负载、阻尼、惯性转矩正方向与之相反 | $T_e=T_L+T_D+J\text p\Omega$ | $P_m=-T_L\Omega$ |
| **发电机** | 1. 外施转矩正方向就是旋转方向<br />2.负载、阻尼、惯性转矩正方向与之相反 | $T_m=T_e+T_D+J\text p\Omega$ | $P_m=T_m\Omega$  |

#### 电磁方程式

> 电枢（转子）按发电机原则规定正方向
>
> 励磁（定子）按电动机原则规定正方向

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模06.png" alt="电机建模06" style="zoom: 40%;" />
$$
\begin{gather*}
\begin{cases}
u_d=\text p\varPsi_d-R_di_d-K_q\omega\phi_q(旋转电势e_{dr})\\
u_q=\text p\varPsi_q-R_qi_q+K_d\omega\phi_d(旋转电势e_{qr})\\
u_{fd}=\text p\varPsi_{fd}+R_{fd}i_{fd}\\
u_{kq}=\text p\varPsi_{kq}+R_{kq}i_{kq}
\end{cases}
\end{gather*}
$$
根据[对应的推导](#一般化电机旋转电势)，旋转电势中：
$$
\begin{gather*}
\begin{cases}
e_{dr}=-K_q\omega\phi_q=-\omega\varPsi_q\\
e_{qr}=K_d\omega\phi_d=\omega\varPsi_d
\end{cases}
\end{gather*}
$$
并带入$\varPsi=LI$，得到电磁方程式为：
$$
\begin{gather*}
[U]=\text p[L][I]+[R][I]+\omega[G][I]\\
\text p[I]=[L]^{-1}({[U]-[R][I]-\omega[G][I]})
\end{gather*}
$$
其中：
$$
\begin{gather*}
[L]=\begin{bmatrix}
-L_d&0&M_{afd}&0\\0&-L_q&0&M_{akq}\\-M_{fad}&0&L_{fd}&0\\0&-M_{kaq}&0&L_q
\end{bmatrix}&,&[G]=\begin{bmatrix}
0&L_q&0&-M_{akq}\\-L_d&0&M_{afd}&0\\0&0&0&0\\0&0&0&0
\end{bmatrix}
\end{gather*}
$$



## 直流电机仿真

### 他励直流电机基本模型

考虑以下他励直流电机：

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模11.jpg" alt="电机建模11" style="zoom: 25%;" />

只有直轴励磁和交轴电枢电压，故其方程为：
$$
\begin{gather*}
u_q=\text p\varPsi_q+\omega\varPsi_d-R_qi_q\\
u_{fd}=\text p\varPsi_{fd}+R_{fd}i_{fd}
\end{gather*}
$$
其中：
$$
\varPsi_d=M_{afd}i_{fd}~;~\varPsi_q=-L_qi_q~;~\varPsi_{fd}=L_{fd}i_{fd}
$$

>注：如果认为磁通全部通过磁链，并且定子和转子完全交链，那么有$\phi_d=\phi_{fd}$
>
>于是：$\varPsi_d=z\phi_d=z\phi_{fd}=z\frac{L_{fd}i_{fd}}{N_{fd}}=M_{afd}i_{fd}$
>
>即：$M_{afd}=\frac{zL_{fd}}{N_{fd}}$

### 他励直流发电机的突然短路（$R_L\rightarrow0$）

#### 稳态

$$
\begin{gather*}
u_{q0}=\omega_0M_{afd}i_{fd}-R_qi_q=R_{L}i_{q}\\u_{fd}=R_{fd}i_{fd}\\\Rightarrow
i_{q0}=\frac{\omega_0M_{afd}u_{fd}}{(R_L+R_q)R_{fd}}
\end{gather*}
$$

#### 条件1. 转速瞬时不变

$$
\begin{gather*}
0=-L_q\text pi_q+\omega_0M_{afd}i_{fd}-R_qi_q\\\Rightarrow
i_q=\frac{\omega_0M_{afd}i_{fd}}{R_q}\frac1{\tau\text p+1}~;~(\tau=L_q/R_q)\\
\Rightarrow i_q=i_{q0}\frac{R_L+R_q}{R_q}(1-e^{-\frac{t+t_0}{t_0}})
\end{gather*}
$$

#### 条件2. 短路时停止提供动力

$$
\begin{gather*}
\begin{cases}\text pi_q=\frac{\omega M_{afd}i_{fd}-R_qi_q}{L_q}\\T_m=0=M_{afd}i_{fd}i_q+B\omega+J\text p\omega  \end{cases}\Rightarrow \text p\omega=\frac{M_{afd}i_{fd}i_q+B\omega}{-J}
\end{gather*}
$$

#### 条件3. 停止原动机时停止励磁

​		此时$i_{fd}=0$,机电解耦！
$$
\text pi_q=-R_qi_q/L_q~,~\text p\omega=-B\omega/J
$$


## 三相交流电机在相坐标系下的模型

按照**电动机**原则选取正方向，即：

1. 绕组轴线的方向是磁链正方向，<u>正电流产生正磁链</u>
2. 从外向绕组看，<u>电压与电流正方向同向</u>，输入功率为正
3. <u>电磁转矩正方向就是转子旋转的方向</u>，负载$T_L$、阻尼$B\Omega$、惯性$Jp\Omega$转矩相反

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模01.png" alt="电机建模01" style="zoom: 50%;" />

考虑D轴与Q轴正交解耦，则其**电压平衡式**为：
$$
\begin{gather*}\begin{cases}U_a=\text p\varPsi_a+R_ai_a&（B、C相同理）\\U_f=\text p\varPsi_f+R_fi_f\\U_D=U_Q=0&（阻尼短路绕组）  \end{cases} \end{gather*}
$$
即：
$$
\begin{gather*}  \begin{bmatrix}
u_a\\u_b\\u_c\\u_f\\0\\0
\end{bmatrix}=\text p\begin{bmatrix}
\varPsi_a\\\varPsi_b\\\varPsi_c\\\varPsi_f\\\varPsi_D\\\varPsi_Q
\end{bmatrix}+\begin{bmatrix}
R_s&0&0&0&0&0\\0&R_s&0&0&0&0\\0&0&R_s&0&0&0\\0&0&0&R_f&0&0\\0&0&0&0&R_D&0\\0&0&0&0&0&R_Q
\end{bmatrix}
\begin{bmatrix}
i_a\\i_b\\i_c\\i_f\\i_D\\i_Q
\end{bmatrix}
\end{gather*}
$$
​		其中磁链矩阵$[\varPsi]$可以表示为$[L][I]$，由于转子励磁旋转导致DQ轴与定子相轴耦合关系改变，电感矩阵$[L]$时变。电感矩阵中各分量结果如下：<a id="三相电感">[三相交流电机电感矩阵推导](#三相交流电机电感矩阵)</a>

1. **定子绕组自感系数**
   $$
   \begin{gather*}
   L_{aa}=L_{aal}(漏感)+\frac{L_{aad}+L_{aaq}}2+\frac{L_{aad}-L_{aaq}}2cos2\theta\\
   L_{bb}=L_{aal}(漏感)+\frac{L_{aad}+L_{aaq}}2+\frac{L_{aad}-L_{aaq}}2cos2(\theta-\frac{2\pi}3)\\
   L_{cc}=L_{aal}(漏感)+\frac{L_{aad}+L_{aaq}}2+\frac{L_{aad}-L_{aaq}}2cos2(\theta+\frac{2\pi}3)
   \end{gather*}
   $$

   1. 对于隐极同步电机（$L_{aad}=L_{aaq}$），自感系数是常数

2. **定子绕组互感系数**
   $$
   \begin{gather*} M_{ab}=-(M_{abl}+\frac{L_{aad}+L_{aaq}}4)+\frac{L_{aad}-L_{aaq}}2cos2(\theta+\frac{2\pi}3)
   \end{gather*}
   $$

   1. 因为三相轴线相差120°，所以互感是负的，说明推导无误
   2. AB相的互感用C相的角度，其余同理

3. **定子与转子之间的互感**
   $$
   \begin{gather*}M_{af}=M_{fa}=M_{af1}cos\theta\\M_{bf}=M_{fb}=M_{af1}cos(\theta-\frac{2\pi}3)\\M_{cf}=M_{fc}=M_{af1}cos(\theta+\frac{2\pi}3) \end{gather*}
   $$

   1. 定子绕组自感变化周期是$\pi$，这个是$2\pi$。下同。

4. **定子绕组与转子D轴阻尼绕组间互感**
   $$
   M_{aD}=M_{Da}=M_{aD1}cos\theta
   $$

5. **定子绕组与转子Q轴阻尼绕组间互感**
   $$
   M_{aQ}=M_{Qa}=-M_{aQ1}sin\theta
   $$

6. **转子绕组自感、互感**
   $$
   \begin{gather*}
   L_f=L_{fl}+L_{f\delta}\\L_D=L_{Dl}+L_{D\delta}\\L_Q=L_{Ql}+L_{Q\delta}\\M_{fD}=M_{Df}=M_{fDl}+M_{fD\delta}
   \end{gather*}
   $$

   1. 由于DQ轴正交解耦，故不存在互感

由此得到：
$$
\begin{gather*}
\begin{bmatrix}
\varPsi_a\\\varPsi_b\\\varPsi_c\\\varPsi_f\\\varPsi_D\\\varPsi_Q
\end{bmatrix}=\begin{bmatrix}
L_{aa}&M_{ab}&M_{ac}&M_{af}&M_{aD}&M_{aQ}\\
M_{ba}&L_{bb}&M_{bc}&M_{bf}&M_{bD}&M_{bQ}\\
M_{ca}&M_{cb}&L_{cc}&M_{cf}&M_{cD}&M_{cQ}\\
M_{fa}&M_{fb}&M_{fc}&L_f&M_{fD}&0\\
M_{Da}&M_{Db}&M_{Dc}&M_{Df}&L_D&0\\
M_{Qa}&M_{Qb}&M_{Qc}&0&0&L_Q
\end{bmatrix}\cdot \begin{bmatrix}
i_a\\i_b\\i_c\\i_f\\i_D\\i_Q
\end{bmatrix}
\end{gather*}
$$
对应的，其<a id="三相转矩">**转矩平衡式**</a>为（[电磁转矩的推导过程](#三相交流电机电磁转矩)）：
$$
T_e=\frac p2[I]^T\frac{\partial[L]}{\partial\theta}[I]
$$


## 坐标变换

一个电机的建模与求解过程应该是下面这样的：

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模07.png" alt="电机建模07" style="zoom: 33%;" />

上一章已经展示了，三相交流电机在相坐标（a-b-c Model）下的模型方程是多么复杂，所以要用坐标变换把他等效到更好计算的坐标系（如α-β-0和d-q-0坐标系）下。

### 坐标变化基本定义

* 下面直接不加推导的给出三相坐标系到（二维平面-0）坐标系的**恒相幅值变换**的表达式：
  * 在三相坐标系中，三个坐标轴为a、b、c，记其方向向量为$\vec a,\vec b,\vec c$，在三个方向向量上的某物理量的数值分别为$x_a,x_b,x_c$
  * 定义**综合矢量：**$\vec x=\frac23(x_a\vec a+x_b\vec b+x_c\vec c)$
  * 定义**零分量：**$x_0=\frac{x_a+x_b+x_c}3$
  * <img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模08.png" alt="电机建模08" style="zoom:33%;" />

* 电机的模型是二维的，所以按理说两个基足以。但是坐标变换必须满足等变量个数，因此这里从“a、b、c”三个基（变量）换成了“综合矢量+零分量”三个变量（矢量=模长+方向，或正交分解，实际是两个变量）
* 但是综合矢量以矢量的形式不好表达，所以可以写成下面这样的形式：
  * 定义：$x_a'=x_a-x_0~,~x_b'=x_b-x_0~,~x_c'=x_c-x_0$
  * **综合矢量：**$\vec x\rightarrow\dot x=\frac23(x_a+x_be^{j120}+x_ce^{j240})\triangleq xe^{j\alpha}$
    * **幅值：**$|x|=\sqrt{\frac23(x_a'^2+x_b'^2+x_c'^2)}$
    * **夹角（与a轴）：**$\alpha=\text{cos}^{-1}(\frac{x_a'}{x_a})$
* 当然，要把（二维平面-0）坐标系变回三相坐标系也是需要的，其表达式为：
  * a相：$x_a'=x\,\text{cos}\alpha~,~x_a=x_0+x_a'$
  * a相：$x_b'=x\,\text{cos}(\alpha-\frac{2\pi}3)~,~x_b=x_0+x_b'$
  * c相：$x_c'=x\,\text{cos}(\alpha+\frac{2\pi}3)~,~x_c=x_0+x_c'$

### 三相电机中坐标变换的重要结论

* 在三相对称系统中，三个物理量并非像定义中的$x_a,x_b,x_c$一般毫无关联，而是由如下类似的表达式：
  * a相：$i_a=I_m\,\text{cos}\theta$
  * b相：$i_b=I_m\,\text{cos}(\theta-\frac{2\pi}3)$
  * c相：$i_c=I_m\,\text{cos}(\theta+\frac{2\pi}3)$
* 把他变换到（二维平面-0）坐标系中是这样的：
  * 零分量：$i_0=\frac{i_a+i_b+i_c}3=0$
  * 综合矢量幅值：$|i|=\sqrt{\frac23(i_a'^2+i_b'^2+i_c'^2)}=\sqrt{\frac23\cdot\frac32I_m^2}=I_m$
  * 综合矢量夹角：$\alpha=\text{cos}^{-1}\frac{i_a'}{|i|}=\text{cos}^{-1}\frac{I_m\,\text{cos}\theta+0}{I_m}=\theta$
  * 即：$\vec i=\dot i=I_me^{j\theta}$
* 也就是说，对于三相对称系统（电压、电流、磁链等大部分都遵循这个规律），有以下重要结论：
  1. **综合矢量的幅值就是三相坐标系中的幅值**
  2. **综合矢量的夹角就是三相坐标系中该矢量与a相的夹角**
  3. **零分量为0**（零分量的物理含义是被相互抵消，基本不产生实际作用的分量）
  4. **三相坐标系中的分量（如$x_a$）就是综合矢量在该轴上的投影**（实际上是$x_a'$，如果$x_0=0$的话$x_a=x_a'$）

### 绕组等效与坐标变换

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模09.png" alt="电机建模09" style="zoom:33%;" />

* 最后需要把拿到的（二维平面-0）坐标系下的综合矢量+零分量的形式用特定的分解方式表示出来。**新坐标系各轴上的分量大小就是综合矢量往该轴的投影**。常用的坐标系有以下这几个（他们的零分量都是一样的）：
  * $\alpha-\beta-0$坐标系：$\alpha$轴与a相重合，$\beta$轴落后90°
  * $d-q-0$坐标系：以角速度旋转，跟电枢是重合的。最常用的坐标系。
  * $d_c-q_c-0$坐标系：以同步速旋转，在未稳定的情况下会比上面那个转的更快一点

* **正变换**（已知$i_a,i_b,i_c$，定义**d轴与a相的夹角为$\theta=\int\omega\text dt+\theta_0$）**：

$$
\begin{gather*}
\begin{pmatrix}
i_d\\i_q\\i_0
\end{pmatrix}=\frac23\begin{pmatrix}
\text{cos}\theta&\text{cos}(\theta-\frac{2\pi}3)&\text{cos}(\theta+\frac{2\pi}3)\\
-\text{sin}\theta&-\text{sin}(\theta-\frac{2\pi}3)&-\text{sin}(\theta+\frac{2\pi}3)\\
\frac12&\frac12&\frac12
\end{pmatrix}\cdot\begin{pmatrix}
i_a\\i_b\\i_c
\end{pmatrix}
\end{gather*}
$$

* **逆变换**：

$$
\begin{gather*}
\begin{pmatrix}
i_a\\i_b\\i_c
\end{pmatrix}
=\begin{pmatrix}
\text{cos}\theta&-\text{sin}\theta&1\\
\text{cos}(\theta-\frac{2\pi}3)&-\text{sin}(\theta-\frac{2\pi}3)&1\\
\text{cos}(\theta+\frac{2\pi}3)&-\text{sin}(\theta+\frac{2\pi}3)&1
\end{pmatrix}\cdot\begin{pmatrix}
i_d\\i_q\\i_0
\end{pmatrix}
\end{gather*}
$$

* 显而易见，上面是到$d-q-0$坐标系的变换，到$\alpha-\beta-0$坐标系更简单，因为$\theta=0$，变换矩阵直接变成常数了



## 坐标下凸极同步电机

### 电磁平衡式

​		这里不加推导（[推导看这里](#d-q-0坐标电压方程式推导)）的给出电压方程式，可以看到和一般化电机的电压方程式几乎一模一样！

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模12.jpg" alt="电机建模12" style="zoom:33%;" />

​		并且不加推导（[推导看这里](#d-q-0坐标磁链表达式推导)）的给出磁链表达式，可以看到所有电感全部变成了常数！唯一美中不足的就是电感矩阵不是一个对称阵

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模13.jpg" alt="电机建模13" style="zoom:33%;" />

其中各参数如下：
$$
\begin{gather*}
直轴同步电感L_d=直轴电枢反应电感L_{ad}+漏电感L_l=\frac32L_{aad}+(L_{aal}+M_{abl})\\
交轴同步电感L_q=交轴电枢反应电感L_{aq}+漏电感L_l=\frac32L_{aaq}+(L_{aal}+M_{abl})\\
L_0=L_{aal}-2M_{abl}
\end{gather*}
$$

 1. 若不是d-q-0坐标变换而是$\alpha-\beta-0$坐标变换，那么[L]也不是常数
 2. 该模型中必须求解$\theta$，因为要进行坐标反变换回到a-b-c坐标底下

### 功率变换

功率表达式：
$$
P_{dq0}=\frac23P_{abc}-u_0i_0~~(P_{abc}=\frac32(P_{dq0+u_0i_0}))
$$
自然的，其中 $P_{dq0}=[I_{dq0}^T][u_{dq0}],~P_{abc}=[I_{abc}]^T[u_{abc}]$

对机械角度而言，有：
$$
T_e=T_D+T_L+T_J~,~P_m=-T_L\Omega
$$
不加推导（[推导看这里](#d-q-0功率表达式推导)）地给出三个功率的表达式：
$$
\begin{gather*}
储能：&P=\Omega J\text p\Omega=\frac32[\text p\varPsi_d,\text p\varPsi_q,2\text p\varPsi_0][I_{dq0}]+[\text p\varPsi_f,\text p\varPsi_D,\text p\varPsi_Q][I_{fDQ}]\\
损耗：&P=B\Omega^2=\frac32R_s(i_d^2+i_q^2+2i_0^2)+[R_{fDQ}]^T[i_f^2;~i_D^2;~i_Q^2]\\电磁：&P=-\Omega T_e=\frac32\omega(\varPsi_di_q-\varPsi_qi_d)
\end{gather*}
$$
因此得到一个与一般化电机非常相似的电磁转矩表达式（下面这个 p 代表极对数）：
$$
T_e=\frac32p(\varPsi_di_q-\varPsi_qi_d)
$$

### 同步电动机对称稳态运行分析

* 以电动机原则作为正方向
* 稳态时电流为常数
* 适用于隐极电机（令 $X_d=X_q$ 即可），但不适用于感应电机（转速不能达到同步速）

#### 发电机空载（开路）

1. 首先0绕组分量均为0（三相对称），因此方程式中均不用考虑了
2. 阻尼绕组短路，即$U_D=U_Q=0$
3. 空载时电枢绕组开路，即$i_a=i_b=i_c=0$，因此有$i_d=i_q=i_0=0$

此时有：
$$
\begin{gather*}
\begin{cases}u_d=\text p\varPsi_d-\omega\varPsi_q+R_di_d\\u_q=\text p\varPsi_q+\omega\varPsi_d+R_qi_q\\ u_f=\text p\varPsi_f+R_fi_f \end{cases}\\
\begin{bmatrix} \varPsi_d\\\varPsi_q\\\varPsi_f  \end{bmatrix}=\begin{bmatrix}
L_d&0&M_{afd1}\\0&L_q&0\\\frac32M_{afd1}&0&L_{ff}
 \end{bmatrix} \begin{bmatrix} i_d\\i_q\\i_f  \end{bmatrix}
\end{gather*}
$$

1. $u_f=R_fi_f$
2. $u_d=\text p~const+\omega\cdot0+0=0$
3. $u_q=\omega M_{af1}i_f=e=E_m$，这个就是**旋转电势**！
4. 可以看到旋转电势没有直轴分量（$u_d=0$），因此旋转电势落在交轴上，励磁磁链（$\varPsi_f$）落在直轴上

#### 负载运行

参考一下电机学里的这张图，但是交轴直轴不对，详见下方注释。

<img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20240421111652775.png" alt="image-20240421111652775" style="zoom: 80%;" />

因此有：
$$
\dot U=\dot E+\dot IR_s+jX_d\dot I_d+jX_q\dot I_q
$$
此时，由于电流为常数，因此仍然有$\text p\varPsi=0$，故：
$$
\begin{gather*} u_d=-\omega L_qi_q+R_di_d=-U_m\sin\delta\\u_q=\omega L_di_d+E_m+R_qi_q=U_m\cos\delta \\i_d=-\frac{E_m-U_m\cos\delta}{X_d}\\i_q=\frac{U_m\sin\delta}{X_q}
\end{gather*}
$$
> 其中$\delta$ 为功角，即上图中的$\varPsi -\varphi$
>
> 电机学里是发电机原则，而这里是电动机原则，因此 $I$ 相差一个负号（电压关系式）
>
> 发电机中 $E$ 超前 $U$，而电动机相反，因此两者功角的定义也不同（也反过来了）

参考同步电机有功功率调节那一章节：
$$
\begin{gather*}
T_e=\frac{3p}{2\omega}(\frac{EU\sin\delta}{X_d}+\frac{U^2}2(\frac1{X_q}-\frac1{X_d})\sin2\delta )\\=\frac32p[(L_d-L_q)i_di_q+(M_{af1}i_f)i_q]\\
P_e=\frac{\omega}pT_e=\frac32(\frac{EU\sin\delta}{X_d}+\frac{U^2}2(\frac1{X_q}-\frac1{X_d})\sin2\delta )
\end{gather*}
$$

1. 调节有功功率就是调节功角 $\delta$
2. 电动机 $\delta>0$，因此 $i_q>0$，不管 $i_d$ 正负，定子电流 $i_q$ 一定超前于转子电流（转子=励磁落在直轴上）

### 电机坐标变换与电源

* 在实际运行中，我们不知道电机的三相电压 $u_a,u_b,u_c$，而我们的模型一直用的是这个。

#### 三相四线制电源

![](\电机建模16.png)

​		在三相四线制电源中，不再满足 $i_a+i_b+i_c=0$ 这一条件。设电源电压为 $u_s$，取空间中任一点 r 作为参考点，对电压进行坐标变换以求得到（二维平面-0）坐标系下的电压，则有：
$$
\begin{gather*}
u_{ar}=u_a+u_{nr}=u_{as}+u_{mr}\\\Rightarrow [C]\begin{bmatrix}u_a\\u_b\\u_c\end{bmatrix}=[C]\begin{bmatrix}u_{as}\\u_{bs}\\u_{cs}\end{bmatrix}+[C]\begin{bmatrix}u_{mn}\\u_{mn}\\u_{mn}\end{bmatrix}\\=
[C]\begin{bmatrix}u_{as}\\u_{bs}\\u_{cs}\end{bmatrix}+\begin{bmatrix}0\\0\\u_{mn}\end{bmatrix}
\end{gather*}
$$

#### 三相三线制电源

​		在三相三线制电源中，虽然满足电流和为零的条件，但是一般情况下我们只知道线电压 $u_{ab}$ 等，这里不加推导地写出：
$$
[C]\begin{bmatrix}u_{a}\\u_{b}\\u_{c}\end{bmatrix}=[C]\begin{bmatrix}u_{ar}\\u_{br}\\u_{cr}\end{bmatrix}-\begin{bmatrix}0\\0\\u_{nr}\end{bmatrix}
$$
如果将参考点 r 正好取在某相（如 c 相），则：
$$
[C]\begin{bmatrix}u_{a}\\u_{b}\\u_{c}\end{bmatrix}=[C]\begin{bmatrix}u_{ac}\\u_{bc}\\0\end{bmatrix}+\begin{bmatrix}0\\0\\u_{nr}\end{bmatrix}
$$
这样就知道电压了。

**结论：！**

由于在（二维平面-0）坐标系中，零分量不产生作用，因此在计算中可以忽略

上面两种情况推出的式子都告诉我们，**即便我们不知道电源相电压，也可以通过对“电源电压”或“线电压”进行变换，得到的结果与原来的只有零分量不同。**可零分量错了有什么关系呢？



# 附录-公式推导

## 一般化电机旋转电势

![电机建模10](F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模10.png)

**[Return](#电磁方程式)**

## 三相交流电机电感矩阵

（贴图绝对不是因为我懒得抄了，绝对不是….）

上过课的人应该看到这两幅图就能想起来大概怎么个证明法

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模02.png" alt="电机建模03" style="zoom: 50%;" />

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模03.png" alt="电机建模03" style="zoom:50%;" />

**[Return](#三相电感)**

## 三相交流电机电磁转矩

**法1 虚功（虚位移）**（下面$\Omega$指机械位移）
$$
\begin{gather*}
W=\frac 12\varPsi_ai_a\Rightarrow W=\frac12[I]^T[L][I] \\
T_e=\frac{\partial W}{\partial\Omega}=p\frac{\partial W}{\partial\theta}=\frac p2[I]^T\frac{\partial [L]}{\partial\theta}[I]
\end{gather*}
$$
**法2 能量守恒**（下面$\Omega$指机械角速度）

电磁储能功率公式推导：
$$
\begin{gather*}
P=\frac{dW}{dt}=\frac12\text p[I]^T[L][I]+\frac12[I]^T\text p[L][I]+\frac12[I]^T[L]\text p[I]\\=[I]^T[L]\text p[I]+\frac12[I]^T\text p[L][I]
\end{gather*}
$$
能量守恒：
$$
\begin{gather*}
P_{abc}=[I]^T[U]=[I]^T\{[R][I]+\text p([L][I]) \}\\
P_{m}=\Omega T_m=-\Omega T_L=-\Omega(T_e-B\Omega-J\text p\Omega)\\
电磁、机械损耗~——~电磁、机械储能~——~电磁、机械储能\\\Rightarrow T_e=\frac p2[I]^T\frac{\partial [L]}{\partial\theta}[I]
\end{gather*}
$$
**[Return](#三相转矩)**

## d-q-0坐标电压方程式推导

$$
\begin{gather*}
\begin{bmatrix}u_{dq0}\\u_{fDQ}\end{bmatrix}=\begin{bmatrix}C&0\\0&E\end{bmatrix}\begin{bmatrix}u_{abc}\\u_{fDQ}\end{bmatrix}\\
=\begin{bmatrix}C&0\\0&E\end{bmatrix}\left(\text p\begin{bmatrix}\varPsi_{abc}\\\varPsi_{fDQ}\end{bmatrix}+ \begin{bmatrix}R_s&0\\0&R_{fDQ}\end{bmatrix}\begin{bmatrix}I_{abc}\\I_{fDQ}\end{bmatrix}\right)  
\end{gather*}
$$

$$
\begin{gather*}
前者=\text p\left(\begin{bmatrix}C&0\\0&E\end{bmatrix}\begin{bmatrix}\varPsi_{abc}\\\varPsi_{fDQ}\end{bmatrix} \right)-\begin{bmatrix}\varPsi_{abc}\\\varPsi_{fDQ}\end{bmatrix}\text p\begin{bmatrix}C&0\\0&E\end{bmatrix}\\
=\text p\begin{bmatrix}\varPsi_{dq0}\\\varPsi_{fDQ}\end{bmatrix}+\begin{bmatrix}-\omega\varPsi_{q}\\\omega\varPsi_{d}\\ [0]_{4\times1}\end{bmatrix}
\end{gather*}
$$

$$
\begin{gather*}
后者=\begin{bmatrix}R_s&0\\0&R_{fDQ}\end{bmatrix}\begin{bmatrix}CI_{abc}&0\\0&I_{fDQ}\end{bmatrix}\\=\begin{bmatrix}R_s&0\\0&R_{fDQ}\end{bmatrix}\begin{bmatrix}I_{dq0}&0\\0&I_{fDQ}\end{bmatrix}
\end{gather*}
$$

[Return](#电磁平衡式)

## d-q-0坐标磁链表达式推导

**法1 嗯算**
$$
\begin{gather*}
\begin{bmatrix}\varPsi_{dq0}\\\varPsi_{fDQ}\end{bmatrix}=\begin{bmatrix}C&0\\0&E\end{bmatrix}\begin{bmatrix}\varPsi_{abc}\\\varPsi_{fDQ}\end{bmatrix}=\begin{bmatrix}C&0\\0&E\end{bmatrix}\begin{bmatrix}L_{ss}&L_{sr} \\L_{rs} &L_{rr}\end{bmatrix}\begin{bmatrix}i_{abc}\\i_{fDQ}\end{bmatrix}\\=\begin{bmatrix}CL_{ss}C^{-1} &CL_{sr} \\ L_{rs}C^{-1} &L_{rr}\end{bmatrix}\begin{bmatrix}i_{dq0}\\i_{fDQ}\end{bmatrix}
\end{gather*}
$$
​		然后只要硬算前面那个恶心人的矩阵就行了

**法2 物理意义的推导**

我放图绝对不是因为我不想抄了，你听我狡辩，绝对不是…

<img src="F:\Paradox_Web\ParadoxTZ.github.io\source\image\电机建模14.jpg" alt="电机建模14" style="zoom: 33%;" />

[Return](#电磁平衡式)



## d-q-0功率表达式推导

### 电损耗

* 机械损耗是 $B\Omega^2$，下面着重分析电损耗
* 需要证明上文的表达式中 $\frac32R_s(i_d^2+i_q^2+2i_0^2)=R_s(i_a^2+i_b^2+i_c^2)$

$$
\begin{gather*}
\frac32R_s(i_d^2+i_q^2+2i_0^2)=\frac32R_s\begin{pmatrix}i_d\\i_q\\i_0\end{pmatrix}^T\begin{pmatrix}i_d\\i_q\\i_0\end{pmatrix}+\frac32R_si_0^2 \\
=\frac32R_s\left[[C]\begin{pmatrix}i_a\\i_b\\i_c\end{pmatrix}  \right]^T[C]\begin{pmatrix}i_a\\i_b\\i_c\end{pmatrix}+\frac32R_si_0^2\\=\frac{R_s}6\begin{pmatrix}i_a\\i_b\\i_c\end{pmatrix}^T\begin{pmatrix}5&-1&-1\\-1&5&-1\\-1&-1&5 \end{pmatrix}\begin{pmatrix}i_a\\i_b\\i_c\end{pmatrix}+\frac32R_s(\frac{i_a+i_b+i_c}3)^2\\=R_s(i_a^2+i_b^2+i_c^2)
\end{gather*}
$$

### 储能

* 机械储能是 $\Omega J\text p\Omega$，下面着重分析电储能
* 需要证明上文的表达式中 $\frac32[\text p\varPsi_d,\text p\varPsi_q,2\text p\varPsi_0][I_{dq0}]+[\text p\varPsi_f,\text p\varPsi_D,\text p\varPsi_Q][I_{fDQ}]=\text p(\frac12[I]^T[\varPsi])$

$$
\begin{gather*}
P=\text p(\frac12[I]^T[\varPsi])=\text p(\frac12[I]^T \begin{bmatrix}C^{-1}&0\\0&E \end{bmatrix}\begin{bmatrix}C&0\\0&E \end{bmatrix}[\varPsi])\\
=\frac12\text p\left(\{\begin{bmatrix}C^{-1T}&0\\0&E \end{bmatrix}[I]\}^T[\varPsi'] \right)\\
=\frac12\text p([\frac32i_d,~\frac32i_q,~3i_0,~[I_r]][\varPsi'])=\frac12\text p([I]'^T[\frac32\varPsi_d,~\frac32\varPsi_q,~3\varPsi_0,~[\varPsi_r]]^T)
\end{gather*}
$$



[Return](#功率变换)

